import "requests"
import "json"
import "time"

op sendJsonReq(ws, req) do {
    ws.send(json.dumps(req))
}

globalMsg = ""
op msgHandler(msg) do {
    globalMsg = msg
}

ws = requests.makeWebsocket("wss://gateway.discord.gg/?v=6&encoding=json")
token = "NTc2OTk0MDk5MjI0MjQ4MzYw.YlTY-w.FmHG6fN3nhkd_Q43buK0b3hn5AU"

ws.setMessageHandler(msgHandler)

payload = {
    "op": 2,
    "d": {
        "token": token,
        "intents": 513,
        "properties": {
            "$os": "linux",
            "$browser": "chrome",
            "$device": "pc"
        }
    }
}

ws.start()

while true do {
    if globalMsg != "" do {
        print(globalMsg)
        globalMsg = ""
    }
}