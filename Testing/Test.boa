import "requests"
import "json"
import "time"

op sendJsonReq(ws, req) do {
    ws.send(json.dumps(req))
}

ws = requests.makeWebsocket("wss://gateway.discord.gg/?v=6&encoding=json")
heartbeatInterval = (json.loads(ws.receive()))["d"]["heartbeat_interval"]
print("Heartbeat interval: " + heartbeatInterval)

token = "NTc2OTk0MDk5MjI0MjQ4MzYw.YlTY-w.FmHG6fN3nhkd_Q43buK0b3hn5AU"

payload = {
    "op": 2,
    "d": {
        "token": token,
        "intents": 513,
        "properties": {
            "$os": "linux",
            "$browser": "chrome",
            "$device": "pc"
        }
    }
}
sendJsonReq(ws, payload)

for i = 0 to 10 do {
    event = ws.receive()
    print(event)
    time.sleepSec(1)
}

ws.close()

