import "requests"
import "json"
ws = requests.makeWebsocket("wss://gateway.discord.gg/?v=6&encoding=json")

token = "Bot ODExMzE3MDEwNjQ1OTA5NTg0.YCwb2A.ZBhmsI0U-KQR7LVkWehDEoEEcAc"

connected = false
op messageHandler(msg) uses[connected] do {
    res = json.loads(msg)
    _op = res["op"]
    print("Called: " + _op)

    # Check the ops
    if _op == 10 do {
        heartbeat = res["d"]["heartbeat_interval"]
        if not connected do {
            connected = true
            heartbeat_p = {
                "op": 1,
                "d": json.NULL
            }
            ws.send(json.dumps(heartbeat_p))
            print("Connected")
        }

        sendId()
    }
}

op sendId() do {
    id = {
        "op": 2,
        "d": {
            "token": token,
            "properties": {
                "$os": "linux",
                "$browser": "chrome",
                "$device": "pc"
            },
            "intents": 513
        }
    }
    ws.send(json.dumps(id))
}

ws.setMessageHandler(messageHandler)

ws.start()

while true do null